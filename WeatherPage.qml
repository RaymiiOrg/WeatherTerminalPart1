

/* Author: Remy van Elst, https://raymii.org
 * License: GNU AGPLv3 */
import QtQuick
import QtQuick.Controls

Page {
    id: root
    width: 1240
    height: 640

    property var parameters: undefined

    property double latitude: 52.3738
    property double longitude: 4.8910

    function getJson(latitude, longitude) {

        var xmlhttp = new XMLHttpRequest()
        var url = "https://api.open-meteo.com/v1/forecast?latitude=" + latitude
                + "&longitude=" + longitude + "&hourly=temperature_2m,relativehumidity_2m,apparent_temperature,weathercode,windspeed_10m,winddirection_10m&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset&current_weather=true&timezone=Europe%2FAmsterdam"

        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === XMLHttpRequest.DONE
                    && xmlhttp.status == 200) {
                root.parameters = JSON.parse(xmlhttp.responseText)
            }
        }
        xmlhttp.open("GET", url, true)
        xmlhttp.send()
    }

    onParametersChanged: console.log(
                             root.parameters['current_weather']['weathercode'])

    WeatherCode {
        id: weatherCode
        anchors.top: parent.top
        anchors.left: parent.left
        anchors.right: parent.right
        parameters: root.parameters
    }

    Temperature {
        id: temperature
        anchors.top: weatherCode.bottom
        anchors.topMargin: 30
        anchors.left: parent.left
        anchors.right: parent.right
        parameters: root.parameters
    }
    Button {
        id: refreshButton
        anchors.bottom: parent.bottom
        anchors.left: parent.left
        anchors.margins: 5
        text: "Update Weather"
        font.pixelSize: 30
        onClicked: getJson(latitude, longitude)
    }

    Button {
        id: exampleButton
        anchors.bottom: parent.bottom
        anchors.left: refreshButton.right
        anchors.margins: 5
        text: "Example"
        font.pixelSize: 30
        onClicked: root.parameters = JSON.parse(exampleJson)
    }

    Button {
        id: quitButtom
        anchors.bottom: parent.bottom
        anchors.left: exampleButton.right
        anchors.margins: 5
        text: "Quit"
        font.pixelSize: 30
        onClicked: Qt.callLater(Qt.quit)
    }

    property string exampleJson: '{"generationtime_ms":2.3009777069091797,"elevation":1.5683594,"hourly":{"apparent_temperature":[-1.6,-1.8,-1.9,-2.2,-2.2,-2.1,-2.4,-1.6,0.2,3.8,6.5,8.8,10.5,11.4,11.5,10.3,9.9,9.1,17.5,6.3,5.8,5.6,5.3,5,4.9,4.8,4.7,4.2,4,3.9,3.8,4.2,6.2,8.8,11.2,13.1,14.6,15.2,15.4,15.4,15,13.6,10.8,9.1,8.2,7.4,7,6.5,5.8,5.2,4.8,4.3,3.9,3.6,3.3,4.1,6.4,8,10.6,12,13.1,13.4,13.2,13.1,12.7,12,10.7,8.4,7.4,6.6,5.8,5.1,4.5,3.8,3.2,2.7,2.1,1.5,1.2,2,4.4,6.4,7.8,9.2,10.2,10.7,10.7,10.7,10.3,9.5,8.3,7.3,6.3,5.1,4.5,4.1,3.6,3.2,2.8,2.4,1.9,1.4,1.5,2.6,4.2,6.4,7.8,9.2,10.8,11.3,11.1,10.9,10.4,9.7,8.6,7.9,7.1,6.2,5.7,5.4,5,4.7,4.4,4.1,3.9,3.7,3.5,3,5,7.7,9.2,10.7,12.2,12.5,12,11.3,10.3,8.9,7,6,5.1,4.2,3.8,3.6,3.4,3.1,2.9,2.6,2.7,2.8,3.4,4.1,5,6.3,7.3,8.4,9.6,10.2,10.6,10.7,10.2,9.3,7.8,6.7,5.3,3.8,3,2.5],"winddirection_10m":[148,158,158,173,165,165,161,166,164,168,169,177,177,170,94,86,69,56,50,52,70,59,69,55,69,78,80,101,108,107,108,119,123,123,109,99,87,87,80,78,62,52,56,58,64,56,63,66,66,72,74,65,66,64,67,75,80,81,65,58,55,55,50,43,39,31,22,21,27,31,33,31,28,22,18,16,12,12,17,17,24,33,36,41,45,45,44,41,36,28,20,21,25,32,34,37,39,39,37,34,32,31,34,42,51,57,58,58,55,51,45,40,35,29,23,23,28,35,38,42,46,47,46,45,43,40,36,14,23,33,37,39,39,39,38,36,34,32,29,29,30,32,35,39,43,43,42,40,40,41,43,46,50,53,52,51,46,41,34,26,26,28,29,27,22,15,9,0],"temperature_2m":[1.7,1.5,1.4,1.1,1.1,1.1,1,1.7,3.6,6.9,9.4,11.6,13.1,14,14.2,13.4,12.6,11.7,10.1,9,8.1,7.6,7.2,6.9,6.7,6.7,6.6,6.3,6.1,6,5.8,6.3,8.1,10.3,12.6,14.4,15.6,16.4,16.9,16.9,16.3,14.8,12.3,10.9,10,9.3,8.9,8.4,7.8,7.2,6.9,6.4,6.2,5.9,5.8,6.5,8.7,10.7,12.8,14.2,15.3,16.1,16.2,16,15.4,14.3,12.4,10.6,9.5,8.7,7.9,7.2,6.6,6,5.5,5,4.6,4.1,3.8,4.5,6.7,9,10.6,11.8,12.7,13.4,13.9,14,13.3,12.2,10.7,9.7,8.7,7.5,6.9,6.4,5.9,5.5,5.2,4.8,4.3,3.8,3.9,5.1,7,9.4,10.9,12.3,13.6,14.3,14.5,14.4,13.6,12.5,11,10.1,9.1,8.1,7.6,7.3,6.9,6.6,6.3,6,5.8,5.6,5.4,5.2,7.1,9.5,11.1,12.7,14.2,14.6,14.5,13.9,12.8,11.4,9.6,8.5,7.6,6.7,6.2,6,5.7,5.4,5.1,4.9,4.9,5,5.6,6.4,7.4,8.8,9.8,10.8,11.9,12.4,12.8,12.7,12.2,11.4,10.1,8.9,7.6,6,5.3,4.8],"weathercode":[0,0,0,0,0,0,0,0,0,0,0,0,2,3,1,1,2,3,3,2,2,1,3,3,3,3,2,1,2,2,3,2,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,2,2,2,3,3,3,2,2,2,1,1,1,2,2,2,2,2,2,0,0,0,0,0],"time":["2022-03-21T00:00","2022-03-21T01:00","2022-03-21T02:00","2022-03-21T03:00","2022-03-21T04:00","2022-03-21T05:00","2022-03-21T06:00","2022-03-21T07:00","2022-03-21T08:00","2022-03-21T09:00","2022-03-21T10:00","2022-03-21T11:00","2022-03-21T12:00","2022-03-21T13:00","2022-03-21T14:00","2022-03-21T15:00","2022-03-21T16:00","2022-03-21T17:00","2022-03-21T18:00","2022-03-21T19:00","2022-03-21T20:00","2022-03-21T21:00","2022-03-21T22:00","2022-03-21T23:00","2022-03-22T00:00","2022-03-22T01:00","2022-03-22T02:00","2022-03-22T03:00","2022-03-22T04:00","2022-03-22T05:00","2022-03-22T06:00","2022-03-22T07:00","2022-03-22T08:00","2022-03-22T09:00","2022-03-22T10:00","2022-03-22T11:00","2022-03-22T12:00","2022-03-22T13:00","2022-03-22T14:00","2022-03-22T15:00","2022-03-22T16:00","2022-03-22T17:00","2022-03-22T18:00","2022-03-22T19:00","2022-03-22T20:00","2022-03-22T21:00","2022-03-22T22:00","2022-03-22T23:00","2022-03-23T00:00","2022-03-23T01:00","2022-03-23T02:00","2022-03-23T03:00","2022-03-23T04:00","2022-03-23T05:00","2022-03-23T06:00","2022-03-23T07:00","2022-03-23T08:00","2022-03-23T09:00","2022-03-23T10:00","2022-03-23T11:00","2022-03-23T12:00","2022-03-23T13:00","2022-03-23T14:00","2022-03-23T15:00","2022-03-23T16:00","2022-03-23T17:00","2022-03-23T18:00","2022-03-23T19:00","2022-03-23T20:00","2022-03-23T21:00","2022-03-23T22:00","2022-03-23T23:00","2022-03-24T00:00","2022-03-24T01:00","2022-03-24T02:00","2022-03-24T03:00","2022-03-24T04:00","2022-03-24T05:00","2022-03-24T06:00","2022-03-24T07:00","2022-03-24T08:00","2022-03-24T09:00","2022-03-24T10:00","2022-03-24T11:00","2022-03-24T12:00","2022-03-24T13:00","2022-03-24T14:00","2022-03-24T15:00","2022-03-24T16:00","2022-03-24T17:00","2022-03-24T18:00","2022-03-24T19:00","2022-03-24T20:00","2022-03-24T21:00","2022-03-24T22:00","2022-03-24T23:00","2022-03-25T00:00","2022-03-25T01:00","2022-03-25T02:00","2022-03-25T03:00","2022-03-25T04:00","2022-03-25T05:00","2022-03-25T06:00","2022-03-25T07:00","2022-03-25T08:00","2022-03-25T09:00","2022-03-25T10:00","2022-03-25T11:00","2022-03-25T12:00","2022-03-25T13:00","2022-03-25T14:00","2022-03-25T15:00","2022-03-25T16:00","2022-03-25T17:00","2022-03-25T18:00","2022-03-25T19:00","2022-03-25T20:00","2022-03-25T21:00","2022-03-25T22:00","2022-03-25T23:00","2022-03-26T00:00","2022-03-26T01:00","2022-03-26T02:00","2022-03-26T03:00","2022-03-26T04:00","2022-03-26T05:00","2022-03-26T06:00","2022-03-26T07:00","2022-03-26T08:00","2022-03-26T09:00","2022-03-26T10:00","2022-03-26T11:00","2022-03-26T12:00","2022-03-26T13:00","2022-03-26T14:00","2022-03-26T15:00","2022-03-26T16:00","2022-03-26T17:00","2022-03-26T18:00","2022-03-26T19:00","2022-03-26T20:00","2022-03-26T21:00","2022-03-26T22:00","2022-03-26T23:00","2022-03-27T00:00","2022-03-27T01:00","2022-03-27T02:00","2022-03-27T03:00","2022-03-27T04:00","2022-03-27T05:00","2022-03-27T06:00","2022-03-27T07:00","2022-03-27T08:00","2022-03-27T09:00","2022-03-27T10:00","2022-03-27T11:00","2022-03-27T12:00","2022-03-27T13:00","2022-03-27T14:00","2022-03-27T15:00","2022-03-27T16:00","2022-03-27T17:00","2022-03-27T18:00","2022-03-27T19:00","2022-03-27T20:00","2022-03-27T21:00","2022-03-27T22:00","2022-03-27T23:00"],"windspeed_10m":[4.2,4,3.9,3.6,3.7,3.4,4.1,4,4.4,4.1,3.6,3.4,3.4,2.6,3.2,5.4,4.7,4,3.8,4.2,3.7,2.9,2.7,2.4,2.5,2.4,2.3,2.9,2.7,2.6,2.3,2.8,2.6,1.8,2,2.2,2.5,3.1,3.4,4.1,3.9,3.6,3.5,3.3,2.7,2.9,2.9,2.9,3,2.8,2.7,2.8,2.8,2.8,3.2,3.2,3.4,4.3,4.2,4.4,4.8,5.3,5.6,5.9,5.9,5.3,4.7,4.8,4.4,4.1,3.7,3.5,3.3,3.3,3.4,3.4,3.6,3.6,3.4,3.5,3.9,5.2,6.1,6.3,6.5,6.7,6.8,6.7,6.4,6,5.6,5.3,5,4.7,4.3,4,3.6,3.4,3.2,3,2.9,2.9,3,3.4,4.2,5.1,5.4,5.5,5.7,6.3,7,7.5,7.1,6.3,5.5,5,4.7,4.3,4,3.7,3.4,3.2,3.1,3,2.7,2.3,2,3.2,3.2,3.4,3.9,4.6,5.3,5.7,6.1,6.4,6.5,6.6,6.5,6.2,5.7,5,4.6,4.2,3.9,3.7,3.6,3.6,3.6,3.6,3.9,4.3,4.8,5.3,5.1,4.7,4.1,3.8,3.5,3.5,3.6,4,4.2,4.1,3.9,3.5,3.3,3],"relativehumidity_2m":[89,87,86,87,85,85,86,83,75,65,59,49,42,39,43,49,54,57,63,69,78,84,87,89,90,89,88,88,87,87,88,87,82,73,67,63,60,58,54,57,63,70,73,75,76,78,79,82,84,85,84,84,84,83,83,79,73,62,61,57,51,44,44,47,52,61,78,75,81,84,86,87,89,91,92,92,91,91,93,91,85,77,70,66,61,56,51,50,55,64,75,79,82,85,87,88,89,90,90,90,92,93,92,85,76,65,58,53,49,47,46,49,54,63,73,80,86,92,94,94,93,94,94,95,95,95,95,93,88,82,75,67,60,58,58,61,67,75,84,87,90,92,93,94,96,96,97,98,99,99,98,94,88,79,74,68,63,61,60,62,64,67,73,78,84,90,92,93]},"latitude":52.38,"daily":{"sunrise":["2022-03-21T05:38","2022-03-22T05:36","2022-03-23T05:33","2022-03-24T05:31","2022-03-25T05:29","2022-03-26T05:26","2022-03-27T05:24"],"temperature_2m_min":[1,5.8,5.8,3.8,3.8,5.2,4.8],"time":["2022-03-21","2022-03-22","2022-03-23","2022-03-24","2022-03-25","2022-03-26","2022-03-27"],"temperature_2m_max":[14.2,16.9,16.2,14,14.5,14.6,12.8],"sunset":["2022-03-21T17:56","2022-03-22T17:58","2022-03-23T18:00","2022-03-24T18:01","2022-03-25T18:03","2022-03-26T18:05","2022-03-27T18:07"],"weathercode":[3,3,1,1,1,1,3]},"longitude":4.9,"hourly_units":{"apparent_temperature":"°C","winddirection_10m":"°","temperature_2m":"°C","weathercode":"wmo code","time":"iso8601","windspeed_10m":"kn","relativehumidity_2m":"%"},"daily_units":{"temperature_2m_min":"°C","sunrise":"iso8601","time":"iso8601","temperature_2m_max":"°C","sunset":"iso8601","weathercode":"wmo code"},"utc_offset_seconds":0,"current_weather":{"weathercode":0,"time":"2022-03-21T13:00","winddirection":170,"windspeed":2.6,"temperature":14}}'
}
